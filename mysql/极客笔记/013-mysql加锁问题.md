# for update | lock in share mode 加锁规则


 innodb 中，锁是在索引树上加的，



# 两个原则，两个优化，一个 bug

  1、原则1：加锁的基本单位时 next-key lock，  
  2、原则2，查找过程中访问到的对象才会加锁  
  3、优化1：索引上的等值查询，给唯一索引加锁的时候，next-key lock 会退化为行锁  
  3、优化2：索引上的等值查询，向右遍历时且最后一个值不满足等值条件时，next-key lock 会退化为 间隙锁，  
  5、bug1：唯一索引上的范围查询，会访问到不满足条件的第一个值为止；  



