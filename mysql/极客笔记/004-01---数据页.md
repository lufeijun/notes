# 概念

  数据库采用数据页的形式组织数据，mysql 默认的非压缩数据页为 16kb ，数据页除了一些原信息外，还有 checksum 校验值，这个值在写入磁盘时计算，读取时需要校验，如果校验失败，会导致 mysql crash。
数据页可以分为：索引页、Undo 页，inode 页，系统页，等
  
  每个数据页大小为 16 kb，每个 byte 使用一个 32 位的 int 值表示，正好对应 innodb 的最大值，64 TB 的存储量，( 16 kb * 2^32 )


# 数据页组成

  每个数据页都有通用的 头部 和 尾部，到那时中部的内容根据 page 的类型不同而不同

  * 头部
    0 ~ 38b，保存两个指针，分别指向 前一个page 和 后一个page，还包括 page 的类型信息 和 用来唯一标识 page 的编号
  
  * 主体数据
    39 ~ 16376b
    

    一、user records 介绍
      在 page 的主体部分，主要关注**数据**和**索引**的存储，都位于 user records 中，user records 由一条条 record 组成，每条记录代表索引树上的一个节点( 叶子|非叶子节点 )，所有 record 组成单链表
    结构，单链表的头尾由两条记录来表示，"infimum" 和 "supremum"
      record 分为以下四类
        a、主键索引树的非叶子节点
        b、主键索引树的叶子节点
        c、辅助索引树的非叶子节点  
        d、辅助索引树的叶子节点
      所有分类的结构中的 next 字段，均是指向下一个 record 节点

    二、user record 介绍
      user record 在 page 内部以单链表的形式存在，最初是按照插入的先后顺序排列，但是，随着旧数据的删除，数据物理顺序会发生改变，但是依然会保持之前的逻辑排序  
  
      查找 user record 的步骤：
        a、通过根节点开始遍历一个索引的 b+ 树，经过各个非叶子节点找到底层叶子节点的数据页，
        b、在 page 内部从 "infimum" 开始遍历单链表，如果找到则返回
        c、如果遍历到 "suprememum" ，说明当前 page 中不存在合适的，则借助 page 的 next page 指针，跳转到下一个 page 继续 a 步骤开始查找

      record 具体分析
        a、主键索引树的非叶子节点
          1、子节点存储的主键里最小的值，这是 B+ 树要求的，作用是在一个 page 离定位到具体的记录位置
          2、最小值所在的 page 编号，作用是定位到对应的 record 所在的 page

        b、主键索引树的叶子节点
          1、主键，B+ 树要求的，也是数据行的一部分
          2、出去主键外所有列，这里就是记录具体信息的节点地方

        c、辅助索引树的非叶子节点  
          1、子节点离存储的辅助键里的最小值，这是 B+ 树要求的，作用是在一个 page 离定位到具体的记录位置

        d、辅助索引树的叶子节点
          1、辅助索引键值，这是 B+ 树要求的，
          2、主键值，用来在主索引树里再做一次 B+ 数检索，来找到整条记录




  * 尾部
    16376 ~ 16384b

  



# 最后蜜汁说明
  page 和 b+树 之间没有一一对应关系，page 只是作为一个 record 的保存容器，它的存在时方便于对磁盘空间进行批量管理，b+ 树引入主要是为了方便快速查找数据



# 参考链接

  * https://segmentfault.com/a/1190000008545713