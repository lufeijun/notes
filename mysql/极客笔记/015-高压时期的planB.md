# 问题描述

 业务高峰期，mysql 压力过大，短时间无法提供服务，需要短时间内、临时性的提升性能



# 短连接风暴

  短连接模式：客户端连接到 mysql 后，执行少量的 SQL 查询后断开，下次请求时重新建立连接，php 就是这种连接模式

  参数 max_connections 用来控制 mysql 客户端连接数量，超过时会返回 too many connections 

### 处理掉占着连接但不工作的线程

  1、show processlist 查找所有状态为 sleep 的线程  
  2、在 information_schema 库的 INNODB_TRX 找到所有记录，  
  3、对比找出没有事务的链接线程，kill 掉  
  4、如果还不能满足要求，找事务内空闲的，没有执行什么 SQL 的线程，kill 掉；  
  5、kill connection 主动断开连接  


### 减少链接过程的消耗

  本质上是跳过权限验证，这个操作很危险，需要保证有数据库连接的白名单



# 慢查询性能问题

  通过日志找到慢查询语句，分析原因并解决

  1、索引没有设计好  
  2、SQL 语句没有写好  
  3、mysql 选错索引  


# QPS 突增问题  (每秒查询次数)

  业务访问量突增 、或者 bug 导致的 qps 爆炸

  业务突增的话，需要重新设计表结构，集群或者分表等办法，解决 mysql 查询更新问题

  如果是bug导致的，就需要下线业务，如果确保业务会下线，但是比较墨迹，就可以考虑从 mysql 运维角度去考虑

    1、假如有 ip白名单 机制，并且新业务使用的新的ip的话，可以直接把 ip 从白名单移除
    2、如果新业务是单独数据库用户，可以直接把用户删除或者权限改变
    3、如果没有以上 1、2 ，可以考虑进行 SQL 重写，=== 风险极大


灵活的 mysql 运维，需要有 虚拟化、白名单机制、多账户体系，



